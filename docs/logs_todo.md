# 邮件 Logs 待办说明

## 背景与问题概述
- 进入 Logs 页面常显示“1天内 0 条”，需手动刷新才开始抓取 Gmail
- UI 切换天数（1/3/7）不稳定，分页状态不可靠
- 稿件数量大，难以快速定位目标记录
- 本 Bot 的 ops log 未记录 Logs 页面相关操作（进入/切换/刷新等）

## 目标
- 进入 Logs 页面即可看到稳定数据
- 切换天数与分页可靠、可预期
- 提供快速定位（关键词/筛选）能力
- 把 Logs 相关操作写入 ops log

## 建议方案（不改业务逻辑）
### 1) 自动刷新与缓存策略
- 进入 Logs 页面时自动触发一次抓取（或缓存过期时抓取）
- 为 Logs 视图添加“最后刷新时间”和“缓存有效期”
- 仅在需要时调用 Gmail 抓取，避免频繁网络请求

### 2) UI 切换与分页稳定性
- 切换天数/模式时重置页码为 0
- 翻页时校验最大页，避免越界或空页
- 如果无数据，提示“暂无记录”，并给出刷新入口

### 3) 搜索与筛选能力
- 增加关键词过滤（标题/subject）
- 支持快速筛选：最近/成功/失败 + 关键词
- 可选：记录用户上一次关键词，复用筛选视图

### 4) ops log 补记
- 在以下操作中记录 log_event：
  - 进入 Logs 页面
  - 切换天数/模式
  - 翻页
  - 刷新
  - 查看详情
- 记录字段建议：days、mode、page、result_count、keyword（如有）

## 涉及文件（当前结构）
- `features/logs_ui.py`：UI 交互与分页
- `integrations/gmail.py`：Gmail 拉取与缓存
- `core/logging_ops.py`：ops log

## 风险与注意事项
- Gmail 抓取应避免阻塞 UI：保持异步/后台线程
- 注意缓存与 UI 的一致性（刷新后重绘）
- 控制 Gmail API 请求频率
